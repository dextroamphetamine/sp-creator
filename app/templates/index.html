<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Playlist Creator</title>
    <!-- Materialize CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Materialize JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Spotify Playlist Creator</h1>
       <div class="row">
    <div class="input-field col s12">
        <input type="text" id="playlistName" aria-label="Enter playlist name" required>
        <label for="playlistName">Playlist Name</label>
        <span class="helper-text" data-error="Please enter a playlist name."></span>
    </div>
</div>
        <div class="row">
            <div class="input-field col s12">
                <input type="text" id="songSearch" placeholder="Search for a song..." onkeydown="if (event.key === 'Enter') searchSong()">
                <label for="songSearch">Song Search</label>
                <button class="btn waves-effect waves-light" onclick="searchSong()">
                    Search
                    <i class="material-icons right">search</i>
                </button>
            </div>
        </div>
        
        <h2>Search Results</h2>
        <div id="searchResults"></div>
        
        <h2>Selected Songs</h2>
        <div id="selectedSongsList"></div>
        
        <button class="btn waves-effect waves-light" onclick="createPlaylist()">Create Playlist</button>
    </div>

    <script>
    let selectedSongs = [];

function searchSong() {
    const query = document.getElementById('songSearch').value;
    fetch(`/search?query=${query}`)
    .then(response => response.json())
    .then(data => {
        let htmlContent = '<div class="row">'; // Start the row

        data.songs.forEach(song => {
            htmlContent += `
                <div class="col s12 m6 l4">
                    <div class="card selectable" id="${song.id}" onclick="toggleSong('${song.id}', '${song.name}', '${song.artist}', '${song.image_url}')" style="background-image: url('${song.image_url}');">
                        <div class="card-content">
                            <p>${song.name} by ${song.artist}</p>
                        </div>
                    </div>
                </div>`;
        });

        htmlContent += '</div>'; // End the row
        const searchResults = document.getElementById('searchResults');
        searchResults.innerHTML = htmlContent;
    });
}


    function toggleSong(id, name, artist, imageUrl) {
    const index = selectedSongs.findIndex(song => song.id === id);
    const cardElement = document.getElementById(id);

    if (index === -1) {
        // Add song to selectedSongs
        selectedSongs.push({ id, name, artist, imageUrl });
        cardElement.classList.add('selected'); // Add a class to visually indicate selection
    } else {
        // Remove song from selectedSongs
        selectedSongs.splice(index, 1);
        cardElement.classList.remove('selected'); // Remove the class to indicate deselection
    }

    // Update the display of selected songs
    const selectedSongsList = document.getElementById('selectedSongsList');
    let htmlContent = '<div class="row">'; // Start the row

    selectedSongs.forEach(song => {
        htmlContent += `
            <div class="col s12 m6 l4">
                <div class="card small">
                    <div class="card-image">
                        <img src="${song.imageUrl}" alt="${song.name} cover">
                    </div>
                    <div class="card-content">
                        <p>${song.name} by ${song.artist}</p>
                    </div>
                </div>
            </div>`;
    });

    htmlContent += '</div>'; // End the row
    selectedSongsList.innerHTML = htmlContent;
}


    function updateSelectedSongsList() {
        const list = document.getElementById('selectedSongsList');
        list.innerHTML = selectedSongs.map(song => `
            <div class="card horizontal">
                <div class="card-image">
                    <img src="${song.imageUrl}" alt="${song.name} cover" width="50">
                </div>
                <div class="card-stacked">
                    <div class="card-content">
                        <p>${song.name}</p>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function createPlaylist() {
        const songIds = selectedSongs.map(song => song.id);
        const playlistName = document.getElementById('playlistName').value || 'My Playlist'; // Default name if none provided

        fetch('/create-playlist', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({song_ids: songIds, name: playlistName})
        })
        .then(response => response.json())
        .then(data => {
            M.toast({html: 'Playlist created!'});
            selectedSongs = [];
            document.getElementById('selectedSongsList').innerHTML = '';
        });
    }
           
          </script>

    <style>
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Pacifico&display=swap');

body {
    font-family: 'Playfair Display', serif;
    background-color: #f4eee8; /* Creamy background */
    color: #5a463d; /* Earthy brown text */
}

h1, h2, h3 {
    font-family: 'Pacifico', cursive;
    text-align: center;
    font-weight: normal;
    border-bottom: 2px dashed #a89f91;
    padding-bottom: 10px;
    margin-bottom: 20px;
    color: #8a735d; /* Muted brown for headers */
}

.song-item, .selected-song-item {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
}

.selectable {
    cursor: pointer;
    transition: background-color 0.3s;
}

.selectable:hover {
    background-color: #f5f5f5; 
}

.selectable.selected {
    background-color: #e0e0e0; 
}

.card {
    border: 2px solid #a89f91; /* Muted border */
    background-color: #e9dfd3; /* Light earthy background */
    margin: 15px;
    transition: transform 0.3s;
    width: 250px;
    height: 350px;
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
   background-size: cover; /* Ensure the background image covers the entire card */
    background-position: center; /* Center the background image */
}
}

.card:hover {
    transform: scale(1.05);
    border-color: #8a735d; /* Earthy brown on hover */
}

.card-content {
    position: absolute;
    bottom: 0;
    width: 100%;
    background-color: rgba(250, 245, 239, 0.8); /* Semi-transparent creamy background */
    color: #5a463d; /* Earthy brown text */
    padding: 10px;
    border-top: 2px dashed #a89f91;
  background-image: linear-gradient(to bottom, rgba(250, 245, 239, 0), rgba(250, 245, 239, 0.8)); /* Add a gradient overlay to make the text more legible */
}
}

.input-field {
    margin: 20px;
    position: relative;
}

.input-field input, .input-field label {
    color: #5a463d; /* Earthy brown text */
}

button {
    background-color: #8a735d; /* Earthy brown for buttons */
    border: none;
    color: #f4eee8; /* Creamy text */
    padding: 10px 20px;
    cursor: pointer;
    margin: 10px;
    border-radius: 5px;
    transition: background-color 0.3s;
    font-family: 'Playfair Display', serif;
}

button:hover {
    background-color: #6f5d52; /* Darken the earthy brown on hover */
}

.row {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    margin: 10px;
}

.col {
    flex: 1;
    max-width: calc(33.33% - 20px);
    margin: 10px;
    box-sizing: border-box;
}

@media (max-width: 768px) {
    .col {
        max-width: calc(50% - 20px);
    }
}

@media (max-width: 480px) {
    .col {
        max-width: 100%;
    }
}

    </style>
</body>
</html>
